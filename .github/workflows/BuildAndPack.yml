name: BuildAndPack
on:
    push:
        branches: [main]
        tags: ['*']
    pull_request:

jobs:
    build-and-publish:
        permissions: 
            contents: read
            id-token: write
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4
            - uses: actions/setup-dotnet@v4
              with:
                dotnet-version: 10.0.x

            - name: dotnet pack
              run: |
                dotnet pack --configuration Release ./Enx.Systemd/Enx.Systemd.csproj
            
            - name: NuGet login (OIDC â†’ temp API key)
              uses: NuGet/login@v1
              id: login
              with:
                # Secret is your NuGet username, e.g. andrewlock
                user: ${{ secrets.NUGET_USER }}

            - name: push to NuGet
              if: startsWith(github.ref, 'refs/tags/v')
              run: dotnet nuget push ./Enx.Systemd/bin/Release/*.nupkg --source https://api.nuget.org/v3/index.json